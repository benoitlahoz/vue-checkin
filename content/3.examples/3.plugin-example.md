# Plugin Example - Plugins et extensions

Démonstration de l'utilisation des plugins pour étendre les fonctionnalités du desk.

## Démo interactive

::plugin-example
::

## Vue d'ensemble

Cet exemple montre comment :
- Utiliser le **ActiveItemPlugin** pour gérer un item actif
- Utiliser le **HistoryPlugin** pour l'historique et undo/redo
- Combiner plusieurs plugins
- Étendre le desk avec des méthodes personnalisées

## Architecture

### Composant Parent : `PluginExample.vue`

Le composant parent crée un desk avec deux plugins.

```vue
<script setup lang="ts">
import { 
  useCheckIn, 
  createActiveItemPlugin, 
  createHistoryPlugin 
} from '@/vue-checkin/composables/useCheckIn';
import PluginListItem from './PluginListItem.vue';
import { PLUGIN_DESK_KEY } from './index';

interface ListItem {
  name: string;
  description: string;
}

// Créer des plugins
const activeItemPlugin = createActiveItemPlugin<ListItem>();
const historyPlugin = createHistoryPlugin<ListItem>({ maxHistory: 10 });

// Créer un desk avec les plugins
const { createDesk } = useCheckIn<ListItem>();
const { desk } = createDesk(PLUGIN_DESK_KEY, {
  debug: true,
  plugins: [activeItemPlugin, historyPlugin],
});

// Typage étendu pour les méthodes des plugins
type DeskWithPlugins = typeof desk & {
  activeId?: Ref<string | number | null>;
  getActive?: () => CheckInItem<ListItem> | null;
  setActive?: (id: string | number | null) => void;
  undo?: () => void;
  redo?: () => void;
  canUndo?: Ref<boolean>;
  canRedo?: Ref<boolean>;
};

const deskWithPlugins = desk as DeskWithPlugins;
</script>
```

### Composant Enfant : `PluginListItem.vue`

```vue
<script setup lang="ts">
import { useCheckIn } from '@/vue-checkin/composables/useCheckIn';
import { PLUGIN_DESK_KEY } from './index';

const props = defineProps<{
  id: string | number;
  name: string;
  description: string;
  isActive: boolean;
}>();

// Auto check-in
useCheckIn<ListItem>().checkIn(PLUGIN_DESK_KEY, {
  id: props.id,
  autoCheckIn: true,
  watchData: true,
  data: () => ({
    name: props.name,
    description: props.description,
  }),
});
</script>
```

### InjectionKey : `index.ts`

```typescript
import type { InjectionKey } from 'vue';
import type { CheckInDesk } from '@/vue-checkin/composables/useCheckIn';

interface PluginItemData {
  name: string;
  description: string;
}

export const PLUGIN_DESK_KEY: InjectionKey<CheckInDesk<PluginItemData>> = Symbol('pluginDesk');

export { default as PluginExample } from './PluginExample.vue';
export { default as PluginListItem } from './PluginListItem.vue';
```

## Plugins utilisés

### ActiveItemPlugin

Gère automatiquement un item actif dans le desk.

**Méthodes ajoutées :**
- `activeId`: Ref de l'ID de l'item actif
- `getActive()`: Retourne l'item actif
- `setActive(id)`: Définit l'item actif

```typescript
const selectItem = (id: string | number) => {
  deskWithPlugins.setActive?.(id);
};

const activeItem = computed(() => deskWithPlugins.getActive?.());
const activeId = computed(() => deskWithPlugins.activeId?.value);
```

### HistoryPlugin

Enregistre l'historique des opérations et permet undo/redo.

**Méthodes ajoutées :**
- `undo()`: Annuler la dernière action
- `redo()`: Refaire l'action annulée
- `canUndo`: Ref booléen indiquant si undo est possible
- `canRedo`: Ref booléen indiquant si redo est possible
- `getHistory()`: Retourne l'historique complet

```typescript
const undo = () => {
  deskWithPlugins.undo?.();
};

const redo = () => {
  deskWithPlugins.redo?.();
};

const canUndo = computed(() => deskWithPlugins.canUndo?.value ?? false);
const canRedo = computed(() => deskWithPlugins.canRedo?.value ?? false);
```

## Fonctionnalités

### Ajouter un item

```typescript
const addItem = () => {
  const id = `item-${Date.now()}`;
  itemsData.value.push({
    id,
    name: `Item ${itemsData.value.length + 1}`,
    description: 'Description de l\'item',
  });
  deskWithPlugins.setActive?.(id);
};
```

### Sélectionner un item

```typescript
const selectItem = (id: string | number) => {
  deskWithPlugins.setActive?.(id);
};
```

L'item actif est automatiquement mis en surbrillance.

### Undo/Redo

```vue
<template>
  <UButton 
    :disabled="!canUndo" 
    @click="undo"
  >
    Annuler
  </UButton>
  <UButton 
    :disabled="!canRedo" 
    @click="redo"
  >
    Refaire
  </UButton>
</template>
```

### Afficher l'historique

```typescript
const history = computed(() => deskWithPlugins.getHistory?.() || []);
```

## Concepts clés

::alert{type="info"}
**Plugins** : Étendent les fonctionnalités du desk sans modifier son code source.
::

::alert{type="info"}
**Composition** : Plusieurs plugins peuvent être combinés pour créer des comportements complexes.
::

::alert{type="warning"}
**Typage** : Les méthodes ajoutées par les plugins nécessitent un cast de type pour être utilisées avec TypeScript.
::

## Créer un plugin personnalisé

```typescript
import type { CheckInPlugin } from '@/vue-checkin/composables/types';

export const createCustomPlugin = <T>(): CheckInPlugin<T> => {
  return {
    name: 'custom-plugin',
    version: '1.0.0',
    
    install: (desk) => {
      // Initialisation du plugin
      console.log('Plugin installé');
      
      return () => {
        // Cleanup
        console.log('Plugin désinstallé');
      };
    },
    
    onCheckIn: (id, data) => {
      console.log('Item enregistré:', id, data);
    },
    
    methods: {
      customMethod: (desk, ...args) => {
        // Méthode personnalisée
        return desk.get(args[0]);
      },
    },
    
    computed: {
      customComputed: (desk) => {
        return computed(() => desk.registry.value.size);
      },
    },
  };
};
```

## Utilisation

```vue
<template>
  <PluginExample />
</template>

<script setup lang="ts">
import { PluginExample } from '@/components/examples/plugin-example';
</script>
```

## Points d'attention

- Les plugins sont installés dans l'ordre du tableau
- Les hooks (`onCheckIn`, `onBeforeCheckOut`, etc.) sont appelés dans l'ordre
- Le typage des méthodes ajoutées nécessite un cast (`as DeskWithPlugins`)
- Les plugins peuvent être réutilisés sur plusieurs desks
- L'historique enregistre toutes les opérations (check-in, check-out, update)
