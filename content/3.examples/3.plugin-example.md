# Plugin Example - Plugins and Extensions

Demonstration of using plugins to extend desk functionality.

## Interactive Demo

::plugin-example
::

## Overview

This example shows how to:
- Use the **ActiveItemPlugin** to manage an active item
- Use the **HistoryPlugin** for history and undo/redo
- Combine multiple plugins
- Extend the desk with custom methods

## Architecture

### Parent Component: `PluginExample.vue`

The parent component creates a desk with two plugins.

```vue
<script setup lang="ts">
import { 
  useCheckIn, 
  createActiveItemPlugin, 
  createHistoryPlugin 
} from '@/vue-checkin/composables/useCheckIn';
import PluginListItem from './PluginListItem.vue';
import { PLUGIN_DESK_KEY } from './index';

interface ListItem {
  name: string;
  description: string;
}

// Create plugins
const activeItemPlugin = createActiveItemPlugin<ListItem>();
const historyPlugin = createHistoryPlugin<ListItem>({ maxHistory: 10 });

// Create a desk with plugins
const { createDesk } = useCheckIn<ListItem>();
const { desk } = createDesk(PLUGIN_DESK_KEY, {
  debug: true,
  plugins: [activeItemPlugin, historyPlugin],
});

// Extended typing for plugin methods
type DeskWithPlugins = typeof desk & {
  activeId?: Ref<string | number | null>;
  getActive?: () => CheckInItem<ListItem> | null;
  setActive?: (id: string | number | null) => void;
  undo?: () => void;
  redo?: () => void;
  canUndo?: Ref<boolean>;
  canRedo?: Ref<boolean>;
};

const deskWithPlugins = desk as DeskWithPlugins;
</script>
```

### Child Component: `PluginListItem.vue`

```vue
<script setup lang="ts">
import { useCheckIn } from '@/vue-checkin/composables/useCheckIn';
import { PLUGIN_DESK_KEY } from './index';

const props = defineProps<{
  id: string | number;
  name: string;
  description: string;
  isActive: boolean;
}>();

// Auto check-in
useCheckIn<ListItem>().checkIn(PLUGIN_DESK_KEY, {
  id: props.id,
  autoCheckIn: true,
  watchData: true,
  data: () => ({
    name: props.name,
    description: props.description,
  }),
});
</script>
```

### InjectionKey: `index.ts`

```typescript
import type { InjectionKey } from 'vue';
import type { CheckInDesk } from '@/vue-checkin/composables/useCheckIn';

interface PluginItemData {
  name: string;
  description: string;
}

export const PLUGIN_DESK_KEY: InjectionKey<CheckInDesk<PluginItemData>> = Symbol('pluginDesk');

export { default as PluginExample } from './PluginExample.vue';
export { default as PluginListItem } from './PluginListItem.vue';
```

## Plugins Used

### ActiveItemPlugin

Automatically manages an active item in the desk.

**Added Methods:**
- `activeId`: Ref of the active item ID
- `getActive()`: Returns the active item
- `setActive(id)`: Sets the active item

```typescript
const selectItem = (id: string | number) => {
  deskWithPlugins.setActive?.(id);
};

const activeItem = computed(() => deskWithPlugins.getActive?.());
const activeId = computed(() => deskWithPlugins.activeId?.value);
```

### HistoryPlugin

Records operation history and allows undo/redo.

**Added Methods:**
- `undo()`: Undo the last action
- `redo()`: Redo the undone action
- `canUndo`: Ref boolean indicating if undo is possible
- `canRedo`: Ref boolean indicating if redo is possible
- `getHistory()`: Returns the complete history

```typescript
const undo = () => {
  deskWithPlugins.undo?.();
};

const redo = () => {
  deskWithPlugins.redo?.();
};

const canUndo = computed(() => deskWithPlugins.canUndo?.value ?? false);
const canRedo = computed(() => deskWithPlugins.canRedo?.value ?? false);
```

## Features

### Adding an Item

```typescript
const addItem = () => {
  const id = `item-${Date.now()}`;
  itemsData.value.push({
    id,
    name: `Item ${itemsData.value.length + 1}`,
    description: 'Item description',
  });
  deskWithPlugins.setActive?.(id);
};
```

### Selecting an Item

```typescript
const selectItem = (id: string | number) => {
  deskWithPlugins.setActive?.(id);
};
```

The active item is automatically highlighted.

### Undo/Redo

```vue
<template>
  <UButton 
    :disabled="!canUndo" 
    @click="undo"
  >
    Undo
  </UButton>
  <UButton 
    :disabled="!canRedo" 
    @click="redo"
  >
    Redo
  </UButton>
</template>
```

### Displaying History

```typescript
const history = computed(() => deskWithPlugins.getHistory?.() || []);
```

## Key Concepts

::alert{type="info"}
**Plugins**: Extend desk functionality without modifying its source code.
::

::alert{type="info"}
**Composition**: Multiple plugins can be combined to create complex behaviors.
::

::alert{type="warning"}
**Typing**: Methods added by plugins require a type cast to be used with TypeScript.
::

## Creating a Custom Plugin

```typescript
import type { CheckInPlugin } from '@/vue-checkin/composables/types';

export const createCustomPlugin = <T>(): CheckInPlugin<T> => {
  return {
    name: 'custom-plugin',
    version: '1.0.0',
    
    install: (desk) => {
      // Plugin initialization
      console.log('Plugin installed');
      
      return () => {
        // Cleanup
        console.log('Plugin uninstalled');
      };
    },
    
    onCheckIn: (id, data) => {
      console.log('Item registered:', id, data);
    },
    
    methods: {
      customMethod: (desk, ...args) => {
        // Custom method
        return desk.get(args[0]);
      },
    },
    
    computed: {
      customComputed: (desk) => {
        return computed(() => desk.registryMap.size);
      },
    },
  };
};
```

## Usage

```vue
<template>
  <PluginExample />
</template>

<script setup lang="ts">
import { PluginExample } from '@/components/examples/plugin-example';
</script>
```

## Important Points

- Plugins are installed in the order of the array
- Hooks (`onCheckIn`, `onBeforeCheckOut`, etc.) are called in order
- Typing added methods requires a cast (`as DeskWithPlugins`)
- Plugins can be reused across multiple desks
- History records all operations (check-in, check-out, update)
