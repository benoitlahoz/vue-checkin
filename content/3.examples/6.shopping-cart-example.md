# Shopping Cart Example - Panier d'achat e-commerce

Exemple concret d'un panier d'achat pour une application e-commerce.

## Démo interactive

::shopping-cart-example
::

## Vue d'ensemble

Cet exemple démontre un cas d'usage réel avec :
- **Gestion de panier** : Ajout/retrait de produits
- **Calcul automatique** : Total mis à jour en temps réel
- **Contrôle de quantité** : Incrémentation/décrémentation
- **Confirmation** : Hook `onBeforeCheckOut` pour confirmer les retraits
- **Validation** : Vérification avant paiement

## Architecture

### Composant Parent : `ShoppingCartExample.vue`

Le composant parent gère le catalogue de produits et le panier.

```vue
<script setup lang="ts">
import { useCheckIn } from '#vue-checkin/composables/useCheckIn';
import ProductCard from './ProductCard.vue';
import { CART_DESK_KEY } from '.';

interface CartItem {
  name: string;
  price: number;
  quantity: number;
  imageUrl?: string;
}

// Créer un desk pour le panier
const { createDesk } = useCheckIn<CartItem>();
const { desk } = createDesk(CART_DESK_KEY, {
  debug: true,
  onCheckIn: (id, data) => {
    console.log(`✅ Produit ajouté au panier: ${data.name}`);
  },
  onCheckOut: (id) => {
    console.log(`❌ Produit retiré du panier: ${id}`);
  },
  onBeforeCheckOut: () => {
    // Confirmer avant de retirer
    const confirmed = confirm('Voulez-vous vraiment retirer ce produit du panier ?');
    return confirmed;
  },
});

// Computed pour le panier
const cartItems = computed(() => desk.getAll());
const cartTotal = computed(() => {
  return cartItems.value.reduce((total, item) => {
    return total + (item.data.price * item.data.quantity);
  }, 0);
});
</script>
```

### Composant Enfant : `ProductCard.vue`

Chaque produit s'enregistre automatiquement comme item du panier.

```vue
<script setup lang="ts">
import { useCheckIn } from '#vue-checkin/composables/useCheckIn';
import { CART_DESK_KEY } from '.';

const props = defineProps<{
  id: string;
  name: string;
  price: number;
  quantity: number;
  imageUrl?: string;
}>();

// Auto check-in pour ajouter au panier
const { desk, checkOut } = useCheckIn<CartItem>().checkIn(CART_DESK_KEY, {
  id: props.id,
  autoCheckIn: true,
  watchData: true,
  data: () => ({
    name: props.name,
    price: props.price,
    quantity: props.quantity,
    imageUrl: props.imageUrl,
  }),
});

const isInCart = computed(() => desk?.has(props.id) ?? false);

const removeFromCart = () => {
  checkOut();
};
</script>
```

### InjectionKey : `index.ts`

```typescript
import type { InjectionKey } from 'vue';
import type { CheckInDesk } from '#vue-checkin/composables/useCheckIn';

interface CartItem {
  name: string;
  price: number;
  quantity: number;
  imageUrl?: string;
}

export const CART_DESK_KEY: InjectionKey<CheckInDesk<CartItem>> = Symbol('cartDesk');

export { default as ShoppingCartExample } from './ShoppingCartExample.vue';
export { default as ProductCard } from './ProductCard.vue';
```

## Fonctionnalités

### Calcul automatique du total

```typescript
const cartTotal = computed(() => {
  return cartItems.value.reduce((total, item) => {
    return total + (item.data.price * item.data.quantity);
  }, 0);
});
```

Le total est recalculé automatiquement à chaque changement dans le panier grâce à `watchData: true`.

### Gestion de la quantité

```typescript
const updateQuantity = (id: string, quantity: number) => {
  const product = products.value.find(p => p.id === id);
  if (product) {
    product.quantity = Math.max(1, quantity);
  }
};
```

Les modifications de quantité sont synchronisées automatiquement avec le desk.

### Confirmation avant retrait

```typescript
onBeforeCheckOut: () => {
  const confirmed = confirm('Voulez-vous vraiment retirer ce produit du panier ?');
  return confirmed;
}
```

Le hook `onBeforeCheckOut` permet d'annuler l'opération en retournant `false`.

### Processus de commande

```typescript
const checkout = () => {
  if (cartItems.value.length === 0) {
    alert('Votre panier est vide !');
    return;
  }

  const orderSummary = cartItems.value
    .map(item => `${item.data.name} x${item.data.quantity} - ${(item.data.price * item.data.quantity).toFixed(2)}€`)
    .join('\n');

  alert(`Commande validée !\n\nRésumé:\n${orderSummary}\n\nTotal: ${cartTotal.value.toFixed(2)}€`);
  desk.clear();
};
```

### Vider le panier

```typescript
const clearCart = () => {
  if (confirm('Voulez-vous vraiment vider le panier ?')) {
    desk.clear();
  }
};
```

## Concepts clés

::alert{type="success"}
**Auto Check-In** : Les produits s'ajoutent automatiquement au panier dès leur rendu.
::

::alert{type="info"}
**Calcul réactif** : Le total et le compteur se mettent à jour automatiquement grâce aux computed.
::

::alert{type="warning"}
**Hooks de validation** : `onBeforeCheckOut` permet de demander confirmation avant suppression.
::

::alert{type="info"}
**Synchronisation** : Les changements de quantité sont automatiquement reflétés dans le desk.
::

## Cas d'usage réels

### E-commerce
- Panier d'achat avec calcul du total
- Gestion des quantités et stocks
- Validation avant suppression

### Gestion de projet
- Suivi des tâches assignées
- Calcul du temps total
- Confirmation avant suppression

### Système de réservation
- Sélection de places/chambres
- Calcul du prix total
- Confirmation de réservation

### Liste de favoris
- Articles sauvegardés
- Organisation par catégories
- Export/partage de la liste

## Avantages de cette approche

1. **Réactivité automatique** : Le total se met à jour sans intervention manuelle
2. **Séparation des responsabilités** : Le parent gère le panier, les enfants leurs données
3. **Validation intégrée** : Hooks pour contrôler les opérations
4. **État centralisé** : Un seul desk pour tout le panier
5. **Scalabilité** : Facile d'ajouter de nouveaux produits

## Points d'attention

- Les produits utilisent `autoCheckIn: true` pour s'ajouter automatiquement au panier
- `watchData: true` assure la synchronisation de la quantité
- `onBeforeCheckOut` retourne `false` pour annuler le retrait
- `desk.clear()` vide tout le panier d'un coup
- Les computed (`cartTotal`, `cartCount`) se recalculent automatiquement

## Extension possible

### Ajout d'un système de promotion

```typescript
const discount = ref(0.1); // 10% de réduction

const cartTotalWithDiscount = computed(() => {
  const subtotal = cartTotal.value;
  return subtotal * (1 - discount.value);
});
```

### Sauvegarde du panier

```typescript
// Sauvegarder dans localStorage
watch(cartItems, (items) => {
  localStorage.setItem('cart', JSON.stringify(items));
}, { deep: true });

// Restaurer au montage
onMounted(() => {
  const saved = localStorage.getItem('cart');
  if (saved) {
    const items = JSON.parse(saved);
    items.forEach(item => {
      desk.checkIn(item.id, item.data);
    });
  }
});
```

### Limite de stock

```typescript
const addToCart = (productId: string) => {
  const product = products.value.find(p => p.id === productId);
  const cartItem = desk.get(productId);
  
  if (cartItem && cartItem.data.quantity >= product.stock) {
    alert('Stock insuffisant !');
    return false;
  }
  
  return true;
};
```

## Utilisation

```vue
<template>
  <ShoppingCartExample />
</template>

<script setup lang="ts">
import { ShoppingCartExample } from '@/components/examples/shopping-cart-example';
</script>
```
